{
	"info": {
		"_postman_id": "cd1844ff-2f64-4024-96d1-f169d80daef0",
		"name": "OCS - setup OMF ingress",
		"description": "Steps required to enable OMF ingress\n<p>\nPrerequisites\n<ul>\n<li>access to an OSIsoft Cloud Services tenant</li>\n<li>information for the following fields below.</li>\n</ul>\n<p>\nLoad the associated environment file and set the following values:\n<p>\n<table border=0 cellpadding=0 cellspacing=0 width=579 style='border-collapse:\n collapse;table-layout:fixed;width:435pt'>\n <col width=150 style='mso-width-source:userset;mso-width-alt:5347;width:113pt'>\n <col width=281 style='mso-width-source:userset;mso-width-alt:9984;width:211pt'>\n <col width=148 style='mso-width-source:userset;mso-width-alt:5262;width:111pt'>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 width=150 style='height:14.4pt;width:113pt'>environment\n  variable</td>\n  <td class=xl1523697 width=281 style='width:211pt'>description</td>\n  <td class=xl1523697 width=148 style='width:111pt'>example</td>\n </tr>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 style='height:14.4pt'>tenant site name</td>\n  <td class=xl1523697></td>\n  <td class=xl6523697><a href=\"https://site.pi.com/\">https://site.pi.com</a></td>\n </tr>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 style='height:14.4pt'>tenantid</td>\n  <td class=xl1523697></td>\n  <td class=xl6523697></td>\n </tr>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 style='height:14.4pt'>namespace</td>\n  <td class=xl1523697>name of new or existing namespace</td>\n  <td class=xl1523697></td>\n </tr>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 style='height:14.4pt'>client_id</td>\n  <td class=xl1523697>used to create objects</td>\n  <td class=xl1523697></td>\n </tr>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 style='height:14.4pt'>client_secret</td>\n  <td class=xl1523697>used to create objects</td>\n  <td class=xl1523697></td>\n </tr>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 style='height:14.4pt'>client</td>\n  <td class=xl1523697>client identy to be used to send OMF payloads</td>\n  <td class=xl1523697></td>\n </tr>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 style='height:14.4pt'>topic</td>\n  <td class=xl1523697>will be associated with client</td>\n  <td class=xl1523697></td>\n </tr>\n <tr height=19 style='height:14.4pt'>\n  <td height=19 class=xl1523697 style='height:14.4pt'>subscription</td>\n  <td class=xl1523697>will associate topic to namespace</td>\n  <td class=xl1523697></td>\n </tr>\n <![if supportMisalignedColumns]>\n <tr height=0 style='display:none'>\n  <td width=150 style='width:113pt'></td>\n  <td width=281 style='width:211pt'></td>\n  <td width=148 style='width:111pt'></td>\n </tr>\n <![endif]>\n</table>\n</p>",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "get token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "80cee09e-cdd6-432a-8497-e868e2aad59a",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"postman.setEnvironmentVariable(\"bearer\", jsonData.access_token);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/x-www-form-urlencoded",
						"type": "text"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "client_credentials",
							"type": "text"
						},
						{
							"key": "client_id",
							"value": "{{client_id}}",
							"type": "text"
						},
						{
							"key": "client_secret",
							"value": "{{client_secret}}",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{url}}/identity/connect/token",
					"host": [
						"{{url}}"
					],
					"path": [
						"identity",
						"connect",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "create namespace",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{bearer}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"Id\": \"{{namespace}}\",\n\t\"TierId\": \"A1\",\n\t\"Region\": \"WestUS\"\n}"
				},
				"url": {
					"raw": "{{url}}/api/v1-preview/Tenants/{{tenantid}}/Namespaces",
					"host": [
						"{{url}}"
					],
					"path": [
						"api",
						"v1-preview",
						"Tenants",
						"{{tenantid}}",
						"Namespaces"
					]
				}
			},
			"response": []
		},
		{
			"name": "get namespaces",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{bearer}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{url}}/api/v1-preview/Tenants/{{tenantid}}/Namespaces/{{namespace}}",
					"host": [
						"{{url}}"
					],
					"path": [
						"api",
						"v1-preview",
						"Tenants",
						"{{tenantid}}",
						"Namespaces",
						"{{namespace}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "create a client - to be completed - create manually using OCS API console",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{bearer}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"type": "text",
						"value": "application/json",
						"disabled": true
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{url}}/api/{{apiversion}}/Tenants/{{tenantid}}/ClientCredentialClients/",
					"host": [
						"{{url}}"
					],
					"path": [
						"api",
						"{{apiversion}}",
						"Tenants",
						"{{tenantid}}",
						"ClientCredentialClients",
						""
					]
				}
			},
			"response": []
		},
		{
			"name": "get client",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "8a86204d-985e-4a32-8b16-231f8b97568b",
						"exec": [
							"var jsonData = JSON.parse(responseBody);\r",
							"var omfclient = postman.getEnvironmentVariable(\"omfclient\")\r",
							"if (omfclient === null) {\r",
							"      console.log(\"variable omfclient not set\")  \r",
							"} else {\r",
							"    for (var i in jsonData) {\r",
							"        if(jsonData[i].Name == omfclient) {\r",
							"            postman.setEnvironmentVariable(\"omfclientid\", jsonData[i].ClientId);\r",
							"        }\r",
							"    }\r",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{bearer}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{url}}/api/{{apiversion}}/Tenants/{{tenantid}}/ClientCredentialClients",
					"host": [
						"{{url}}"
					],
					"path": [
						"api",
						"{{apiversion}}",
						"Tenants",
						"{{tenantid}}",
						"ClientCredentialClients"
					]
				}
			},
			"response": []
		},
		{
			"name": "create topic",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "b32edf3c-9b0e-44dd-8eb6-80a7f1501adb",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"postman.setEnvironmentVariable(\"topicid\", jsonData.Id);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{bearer}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n\t\"Name\": \"{{topic}}\",\r\n\t\"Description\": \"load sample data\",\r\n\t\"TenantId\": \"{{tenantid}}\",\r\n\t\"NamespaceId\": \"{{namespace}}\",\r\n\t\"Clientids\": [\r\n\t\t\"{{omfclientid}}\"\r\n\t]\r\n}"
				},
				"url": {
					"raw": "{{url}}/api/{{apiversion}}/Tenants/{{tenantid}}/Namespaces/{{namespace}}/Topics",
					"host": [
						"{{url}}"
					],
					"path": [
						"api",
						"{{apiversion}}",
						"Tenants",
						"{{tenantid}}",
						"Namespaces",
						"{{namespace}}",
						"Topics"
					]
				}
			},
			"response": []
		},
		{
			"name": "get topics",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{bearer}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"type": "text",
						"value": "application/json",
						"disabled": true
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{url}}/api/{{apiversion}}/Tenants/{{tenantid}}/Namespaces/{{namespace}}/Topics",
					"host": [
						"{{url}}"
					],
					"path": [
						"api",
						"{{apiversion}}",
						"Tenants",
						"{{tenantid}}",
						"Namespaces",
						"{{namespace}}",
						"Topics"
					]
				}
			},
			"response": []
		},
		{
			"name": "create subscription",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{bearer}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n\t\"Name\": \"{{subscription}}\",\r\n\t\"Description\": \"omf samples\",\r\n\t\"TopicId\": \"{{topicid}}\",\r\n\t\"TopicTenantId\": \"{{tenantid}}\",\r\n\t\"TenantId\": \"{{tenantid}}\",\r\n\t\"Type\": 1,\r\n\t\"NamespaceId\": \"{{namespace}}\",\r\n\t\"TopicNamespaceId\": \"{{namespace}}\",\r\n\t\"TierId\": \"A1\"\r\n}"
				},
				"url": {
					"raw": "{{url}}/api/{{apiversion}}/Tenants/{{tenantid}}/Namespaces/{{namespace}}/Subscriptions",
					"host": [
						"{{url}}"
					],
					"path": [
						"api",
						"{{apiversion}}",
						"Tenants",
						"{{tenantid}}",
						"Namespaces",
						"{{namespace}}",
						"Subscriptions"
					]
				}
			},
			"response": []
		},
		{
			"name": "get Subscription",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{bearer}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{url}}/api/{{apiversion}}/Tenants/{{tenantid}}/Namespaces/{{namespace}}/Subscriptions",
					"host": [
						"{{url}}"
					],
					"path": [
						"api",
						"{{apiversion}}",
						"Tenants",
						"{{tenantid}}",
						"Namespaces",
						"{{namespace}}",
						"Subscriptions"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "c8b42243-df26-4716-bbc0-f87ac5a105fe",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "bb176fbb-8ad8-42fb-af82-d4fb5e1df687",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}